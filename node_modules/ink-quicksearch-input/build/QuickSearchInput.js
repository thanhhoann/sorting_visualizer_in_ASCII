"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var react_1 = __importStar(require("react"));
var ink_1 = require("ink");
var has_ansi_1 = __importDefault(require("has-ansi"));
var lodash_isequal_1 = __importDefault(require("lodash.isequal"));
// @ts-ignore This module makes stdin emit keypress events,
// that's it.  Hasn't been published in six years, no types
// available.
var keypress_1 = __importDefault(require("keypress"));
var defaultValue = { label: '' }; // Used as return for empty array
// For the following four, whitespace is important
var IndicatorComponent = function (_a) {
    var isSelected = _a.isSelected;
    return react_1.default.createElement(ink_1.Color, { hex: "#00FF00" },
        isSelected ? '>' : ' ',
        " ");
};
var ItemComponent = function (_a) {
    var isSelected = _a.isSelected, children = _a.children;
    return (react_1.default.createElement(ink_1.Color, { hex: isSelected ? '#00FF00' : '' }, children));
};
var HighlightComponent = function (_a) {
    var children = _a.children;
    return (react_1.default.createElement(ink_1.Color, { bgHex: "#6C71C4" }, children));
};
var StatusComponent = function (_a) {
    var hasMatch = _a.hasMatch, children = _a.children, label = _a.label;
    return (react_1.default.createElement(ink_1.Text, null, (label || 'Query') + ": ",
        react_1.default.createElement(ink_1.Color, { hex: '#74BEFF' }, children)));
};
exports.QuickSearch = function (props) {
    var _a = Object.assign({}, defaultProps, props), items = _a.items, onSelect = _a.onSelect, focus = _a.focus, clearQueryChars = _a.clearQueryChars, limit = _a.limit, indicatorComponent = _a.indicatorComponent, itemComponent = _a.itemComponent, highlightComponent = _a.highlightComponent, statusComponent = _a.statusComponent, label = _a.label, forceMatchingQuery = _a.forceMatchingQuery;
    // Map prop components onto capitalized names, required
    // for JSX to recognize em
    var Indicator = indicatorComponent;
    var Item = itemComponent;
    var Highlight = highlightComponent;
    var Status = statusComponent;
    var _b = react_1.useState({
        selection: 0,
        start: 0
    }), windowIndices = _b[0], setWindowIndices = _b[1];
    var _c = react_1.useState(''), query = _c[0], setQuery = _c[1];
    var matchingItems = react_1.useMemo(function () {
        return getMatchingItems();
    }, [items, query]);
    var usingLimitedView = limit !== 0 && matchingItems.length > limit;
    var inkStdin = ink_1.useStdin();
    react_1.useEffect(function listenToRawKeyboard() {
        keypress_1.default(inkStdin.stdin);
        if (inkStdin.isRawModeSupported)
            inkStdin.setRawMode(true);
        inkStdin.stdin.addListener('keypress', handleKeyPress);
        return function () {
            inkStdin.stdin.removeListener('keypress', handleKeyPress);
            if (inkStdin.isRawModeSupported)
                inkStdin.setRawMode(false);
        };
    }, [inkStdin, query, items, windowIndices]);
    var itemRef = react_1.useRef(items);
    react_1.useEffect(function resetForNewItems() {
        if (!lodash_isequal_1.default(items, itemRef.current)) {
            itemRef.current = items;
            setWindowIndices({
                selection: 0, start: 0
            });
            setQuery('');
        }
    }, [items]);
    var getValue = function () {
        return matchingItems[windowIndices.selection] || defaultValue;
    };
    function getMatchIndex(label, query) {
        return props.caseSensitive ?
            label.indexOf(query) :
            label.toLowerCase().indexOf(query.toLowerCase());
    }
    function getMatchingItems(alternateQuery) {
        var matchQuery = alternateQuery || query;
        if (matchQuery === '')
            return items;
        return items.filter(function (item) { return getMatchIndex(item.label, matchQuery) >= 0; });
    }
    function removeCharFromQuery() {
        setQuery(function (query) { return query.slice(0, -1); });
    }
    function addCharToQuery(newChar) {
        setQuery(function (query) {
            var newQuery = query + newChar;
            var newMatching = getMatchingItems(newQuery);
            if (newMatching.length === 0 && forceMatchingQuery) {
                return query;
            }
            else {
                setWindowIndices({ start: 0, selection: 0 });
                return newQuery;
            }
        });
    }
    function selectUp() {
        setWindowIndices(function (windowIndices) {
            var selection = windowIndices.selection, start = windowIndices.start;
            var newSelection = selection;
            var newStart = start;
            if (selection === 0) {
                // Wrap around to the bottom
                newSelection = matchingItems.length - 1;
                if (usingLimitedView) {
                    newStart = matchingItems.length - limit;
                }
            }
            else {
                // Go up, potentially moving up window, unless
                // it is already 0.
                newSelection -= 1;
                if (usingLimitedView) {
                    if (selection - start <= 1 && start > 0) {
                        newStart -= 1;
                    }
                }
            }
            return {
                selection: newSelection,
                start: newStart
            };
        });
    }
    function selectDown() {
        setWindowIndices(function (_a) {
            var start = _a.start, selection = _a.selection;
            var newStart = start;
            var newSelection = selection;
            if (selection === matchingItems.length - 1) {
                // Wrap around to the top
                newSelection = 0;
                if (newStart !== 0)
                    newStart = 0;
            }
            else {
                // Go down, potentially moving window
                newSelection++;
                if (limit && matchingItems.length > limit && newSelection - newStart >= limit - 1) {
                    newStart += 1;
                }
            }
            return {
                start: newStart,
                selection: newSelection
            };
        });
    }
    function handleKeyPress(ch, key) {
        if (!focus)
            return;
        if (!key && parseInt(ch) !== NaN) {
            addCharToQuery(ch);
            return;
        }
        if (clearQueryChars.indexOf(ch) !== -1) {
            setQuery('');
        }
        else if (key.name === 'return') {
            onSelect(getValue());
        }
        else if (key.name === 'backspace') {
            removeCharFromQuery();
        }
        else if (key.name === 'up') {
            selectUp();
        }
        else if (key.name === 'down') {
            selectDown();
        }
        else if (key.name === 'tab') {
            if (key.shift === false) {
                selectDown();
            }
            else {
                selectUp();
            }
        }
        else if (has_ansi_1.default(key.sequence)) {
            // Ignore fancy Ansi escape codes
        }
        else {
            addCharToQuery(ch);
        }
    }
    var begin = windowIndices.start;
    var end = items.length;
    if (limit !== 0)
        end = Math.min(begin + limit, items.length);
    var visibleItems = matchingItems.slice(begin, end);
    return (react_1.default.createElement(ink_1.Box, { key: 'quicksearch-input', flexDirection: 'column' },
        react_1.default.createElement(ink_1.Box, { key: 'status-label' },
            react_1.default.createElement(Status, { label: label, hasMatch: visibleItems.length > 0 }, query)),
        visibleItems.length === 0 ?
            react_1.default.createElement(ink_1.Box, { key: 'no-items-found' }, "No matches") :
            visibleItems.map(function (item) {
                var isSelected = matchingItems.indexOf(item) === windowIndices.selection;
                var isHighlighted = undefined;
                var itemProps = { isSelected: isSelected, isHighlighted: isHighlighted, item: item };
                var label = item.label;
                var queryStart = getMatchIndex(label, query);
                var queryEnd = queryStart + query.length;
                var labelComponent;
                itemProps.isHighlighted = true;
                var preMatch = label.slice(0, queryStart);
                var match = label.slice(queryStart, queryEnd);
                var postMatch = label.slice(queryEnd);
                labelComponent = (react_1.default.createElement(ink_1.Text, null,
                    preMatch,
                    react_1.default.createElement(Highlight, null, match),
                    postMatch));
                return (react_1.default.createElement(ink_1.Box, { flexDirection: 'row', key: "item-" + item.label },
                    react_1.default.createElement(Item, __assign({}, itemProps),
                        react_1.default.createElement(Indicator, __assign({}, itemProps)),
                        labelComponent)));
            }),
        !usingLimitedView ? null : (react_1.default.createElement(ink_1.Box, { key: 'num-visible-items' },
            react_1.default.createElement(HighlightComponent, null,
                "Viewing ",
                begin,
                "-",
                end,
                " of ",
                matchingItems.length,
                " matching items (",
                items.length,
                " items overall)")))));
};
var defaultProps = {
    focus: true,
    caseSensitive: false,
    limit: 0,
    forceMatchingQuery: true,
    clearQueryChars: [
        '\u0015',
        '\u0017',
    ],
    initialSelectionIndex: 0,
    indicatorComponent: IndicatorComponent,
    itemComponent: ItemComponent,
    highlightComponent: HighlightComponent,
    statusComponent: StatusComponent
};
exports.default = exports.QuickSearch;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUXVpY2tTZWFyY2hJbnB1dC5qcyIsInNvdXJjZVJvb3QiOiIuL3NyYy8iLCJzb3VyY2VzIjpbIlF1aWNrU2VhcmNoSW5wdXQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQXlIO0FBQ3pILDJCQUFpRDtBQUNqRCxzREFBK0I7QUFDL0Isa0VBQXFDO0FBQ3JDLDJEQUEyRDtBQUMzRCwyREFBMkQ7QUFDM0QsYUFBYTtBQUNiLHNEQUFnQztBQUVoQyxJQUFNLFlBQVksR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLGlDQUFpQztBQVdyRSxrREFBa0Q7QUFDbEQsSUFBTSxrQkFBa0IsR0FBbUIsVUFBQyxFQUFjO1FBQVosMEJBQVU7SUFDcEQsT0FBTyw4QkFBQyxXQUFLLElBQUMsR0FBRyxFQUFDLFNBQVM7UUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRztZQUFVLENBQUM7QUFDbEUsQ0FBQyxDQUFDO0FBRUYsSUFBTSxhQUFhLEdBQW1CLFVBQUMsRUFBd0I7UUFBdEIsMEJBQVUsRUFBRSxzQkFBUTtJQUFPLE9BQUEsQ0FDaEUsOEJBQUMsV0FBSyxJQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFHLFFBQVEsQ0FBUyxDQUM5RDtBQUZtRSxDQUVuRSxDQUFDO0FBRUYsSUFBTSxrQkFBa0IsR0FBTyxVQUFDLEVBQVk7UUFBVixzQkFBUTtJQUFPLE9BQUEsQ0FDN0MsOEJBQUMsV0FBSyxJQUFDLEtBQUssRUFBQyxTQUFTLElBQUUsUUFBUSxDQUFTLENBQzVDO0FBRmdELENBRWhELENBQUM7QUFPRixJQUFNLGVBQWUsR0FBb0IsVUFBQyxFQUE2QjtRQUEzQixzQkFBUSxFQUFFLHNCQUFRLEVBQUUsZ0JBQUs7SUFBTyxPQUFBLENBQ3hFLDhCQUFDLFVBQUksUUFBRSxDQUFHLEtBQUss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